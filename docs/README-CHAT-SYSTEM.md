# نظام المحادثات (Chat System)

تم إنشاء نظام محادثات بين المستخدمين والمشرف (Admin) ليتيح التواصل المباشر بين العملاء وفريق الدعم. يتمتع هذا النظام بالمميزات التالية:

## المميزات الرئيسية:

1. **محادثات بين المستخدمين والمشرف فقط**:
   - لا يمكن للمستخدمين التواصل مع بعضهم البعض
   - كل محادثة هي بين مستخدم واحد والمشرف

2. **واجهة مشابهة لتطبيق واتساب**:
   - قائمة المحادثات للمشرف تظهر أسماء المستخدمين
   - عرض آخر رسالة وتاريخها لكل محادثة
   - مؤشر للرسائل غير المقروءة

3. **إشعارات الرسائل الجديدة**:
   - تنبيه للمشرف عند وصول رسائل جديدة
   - تنبيه للمستخدم عند الرد على رسائلهم

4. **تحديثات في الوقت الحقيقي**:
   - تظهر الرسائل فوراً باستخدام Supabase Realtime
   - تحديث حالة القراءة تلقائياً

## تثبيت وإعداد النظام:

1. **تطبيق مخطط قاعدة البيانات**:
   ```bash
   npm run apply-chat-migration
   ```

2. **التأكد من عمل النظام**:
   - تسجيل الدخول كمستخدم عادي والتأكد من ظهور زر المحادثة
   - تسجيل الدخول كمشرف والتحقق من قائمة المحادثات

## استخدام النظام:

### للمستخدمين:
- يظهر زر المحادثة في أسفل يسار الشاشة
- الضغط على الزر يفتح نافذة المحادثة
- يمكن إرسال رسائل نصية إلى المشرف
- تظهر إشعارات بالنقطة الحمراء عند وجود رسائل جديدة

### للمشرف:
- الوصول إلى صفحة المحادثات من القائمة الجانبية أو من قائمة المستخدم
- عرض قائمة بجميع المحادثات مع أسماء المستخدمين
- فتح محادثة بالضغط على اسم المستخدم
- عرض الرسائل غير المقروءة لكل محادثة

## ملاحظات فنية:

1. **جداول قاعدة البيانات**:
   - `conversations`: معلومات المحادثات بين المستخدمين والمشرف
   - `messages`: الرسائل المرسلة في كل محادثة

2. **الاستماع للأحداث في الوقت الحقيقي**:
   - استخدام Supabase Realtime لعرض الرسائل الجديدة دون الحاجة للتحديث
   - الاشتراك في التغييرات على جداول المحادثات والرسائل

3. **الأمان**:
   - تطبيق سياسات Row Level Security (RLS) لضمان خصوصية المحادثات
   - لا يمكن للمستخدمين رؤية محادثات غيرهم
   - المشرف فقط يمكنه رؤية جميع المحادثات 