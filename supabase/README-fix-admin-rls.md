# إصلاح سياسات RLS للمسؤولين

هذا الملف يشرح كيفية إصلاح مشكلة المسؤولين الذين لا يستطيعون الوصول إلى لوحة التحكم والمحتوى الخاص بالمسؤولين بعد تفعيل سياسات RLS.

## المشكلة

عند تفعيل سياسات RLS (Row-Level Security) في Supabase، فإن المستخدمين الذين لديهم صلاحية `is_admin=true` يتم التعامل معهم كمستخدمين عاديين، وبالتالي لا يستطيعون الوصول إلى محتوى لوحة التحكم أو إجراء عمليات الإدارة.

## الحل

نحتاج إلى تعديل سياسات RLS لتتحقق من صلاحية المسؤول وتسمح للمستخدمين المسؤولين بتجاوز قيود الأمان.

## خطوات التطبيق

1. قم بنسخ محتوى ملف `fix-admin-rls.sql` من مجلد `supabase`.
2. انتقل إلى قاعدة البيانات في Supabase وافتح واجهة SQL.
3. الصق الكود واضغط على "Run" لتنفيذه.
4. إذا واجهت أي أخطاء، يمكنك تنفيذ الاستعلامات بشكل منفصل:
   - قم بإنشاء وظيفة `auth.is_admin()` أولاً.
   - ثم قم بحذف السياسات الحالية.
   - ثم قم بإنشاء السياسات الجديدة.

## اختبار الإصلاح

بعد تطبيق الإصلاح، يجب أن يتمكن المستخدمون المسؤولون من:
1. الانتقال إلى لوحة التحكم.
2. إدارة المنتجات والفئات والإعدادات.
3. عرض وإدارة جميع الطلبات بغض النظر عن المستخدم الذي أنشأها.

## ملاحظات إضافية

- هذا الإصلاح يعتمد على وجود حقل `is_admin` في جدول `users`.
- يفترض أن سياسات RLS مفعلة على الجداول المذكورة.
- إذا كان لديك جداول إضافية مع سياسات RLS، ستحتاج إلى تعديل السياسات لها بنفس الطريقة. 